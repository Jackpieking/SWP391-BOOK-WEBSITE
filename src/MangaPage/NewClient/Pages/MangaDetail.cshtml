@page "/MangaDetail/{ComicIdentifier:guid}"
@using System.Text;
@model NewClient.Pages.MangaDetailModel
@{
	ViewData["Title"] = "Manga Detail";
}
<!-- Page Preloder -->
<div id="preloder">
    <div class="loader"></div>
</div>

<!-- Header Section Begin -->
<header class="header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2">
                <div class="header__logo">
                    <a asp-page="Index">
                        <img src="/image/Logo.png" alt="">
                    </a>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="header__nav">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li class="active"><a asp-page="Index">Trang chủ</a></li>
                            <li><a href="./categories.html">Hạng mục</a></li>
                            <li><a href="./blog.html">Bài viết</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="col-lg-2">
                <div class="header__right">
                    <a href="#" class="search-switch"><span class="icon_search search__icon"></span></a>
                    <a href="./login.html"><span class="icon_profile profile__icon"></span></a>
                </div>
            </div>
        </div>
        <div id="mobile-menu-wrap"></div>
    </div>
</header>
<!-- Header End -->
<!-- fix this to specific anime/manga category -->
<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__links">
                    <a asp-page="Index"><i class="fa fa-home"></i> Trang chủ</a>
                    <a asp-page="MangaDetail" asp-route-ComicIdentifier="@Model.ComicWithPublisherModel.ComicIdentifier"> @Model.ComicWithPublisherModel.ComicName</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->
<!-- Anime Section Begin -->
<section class="anime-details spad">
    <div class="container">
        <div class="anime__details__content">
            <div class="row">
                <div class="col-lg-3">
                    <div class="anime__details__pic set-bg" data-setbg="/image/comic/comic_avatar/@Model.ComicWithPublisherModel.ComicAvatar">
                        <div class="comment"><i class="fa fa-comments"></i> @Model.ComicWithPublisherModel.ReviewComicDtos.Count()</div>
                        <div class="view"><i class="fa fa-eye"></i> @Model.ComicWithPublisherModel.NumberOfReaderHasRead</div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="anime__details__text">
                        <div class="anime__details__title">
                            <h3>@Model.ComicWithPublisherModel.ComicName</h3>
@*                            <span>フェイト／ステイナイト, Feito／sutei naito</span>*@
                        </div>
                        <div class="anime__details__rating">
                            @{
                                var totalStars = default(decimal);
                                var averageStars = default(decimal);
                                var reviewComicDtoCount = Model.ComicWithPublisherModel.ReviewComicDtos.Count();

                                if (reviewComicDtoCount == 0)
                                {
                                    averageStars = 0;
                                }
                                else
                                {
                                    foreach (var reviewComic in Model.ComicWithPublisherModel.ReviewComicDtos)
                                    {
                                        totalStars += reviewComic.ComicRatingStar;
                                    }

                                    averageStars = totalStars / reviewComicDtoCount;
                                }
                            }
                            <div class="rating">
                                @for (int displayStar = 1; displayStar <= averageStars; displayStar++)
                                {
                                    <i class="fa fa-star"></i>
                                }

                                @for (int displayStar = 0; displayStar < averageStars - Math.Floor(d: averageStars); displayStar++)
                                {
                                    <i class="fa fa-star-half-o"></i>
                                }
                            </div>
                            <span>@reviewComicDtoCount Bình chọn</span>
                        </div>
                        <p>@Model.ComicWithPublisherModel.ComicDescription</p>
                        <div class="anime__details__widget">
                            <div class="row">
                                <div class="col-lg-12 col-md-12">
                                    <ul>
                                        <li><span>Người đăng:</span> @Model.ComicWithPublisherModel.PublisherName</li>
                                        <li><span>Ngày đăng:</span> @Model.ComicWithPublisherModel.ComicPublishDate</li>
                                        <li><span>Chương mới nhất:</span> @Model.ComicWithPublisherModel.ComicLatestChapter</li>
                                        <li>
                                            <span>Thể loại: </span>
                                            @string.Join(", ", Model.ComicWithPublisherModel.CategoryNames)
                                        </li>
                                        <li><span>Số người đã đọc:</span> @Model.ComicWithPublisherModel.NumberOfReaderHasRead</li>
                                        <li><span>Số bình luận:</span> @reviewComicDtoCount</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="anime__details__btn">
                            <a href="#" class="follow-btn"><i class="fa fa-heart-o"></i> Yêu thích</a>
                            <a href="#" class="watch-btn">
                                <span>Đọc ngay
                                    <i class="fa fa-angle-right"></i>
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-5">
            <div class="section-title mb-4">
                <h5>Danh sách chương</h5>
            </div>
            <div class="col-lg-12 col-md-12">
                <div class="card bg-dark border-white" style="height:357px;overflow-y:scroll">
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            @for (double chapterNumber = 1; chapterNumber <= Model.ComicWithPublisherModel.ComicLatestChapter; chapterNumber++)
                            {
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-end bg-dark p-1">
                                    <div>
                                        <a href="#" class="text-bg-dark">Chapter @chapterNumber</a>
                                    </div>
                                    <div>
                                        <p class="text-bg-dark mb-0">20/22/2202</p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 col-md-8">
                <div class="anime__details__review">
                    <div class="section-title mb-4">
                        <h5>Bình luận</h5>
                    </div>
                    @foreach (var reviewItem in Model.ComicWithPublisherModel.ReviewComicDtos)
                    {
                        <div class="anime__review__item">
                            <div class="anime__review__item__pic">
                                <img src="/image/user/@reviewItem.UserAvatar" alt="">
                            </div>
                            <div class="anime__review__item__text">
                                <div class="rating">
                                    @for (int star = 0; star < reviewItem.ComicRatingStar; star++)
                                    {
                                        <i class="fa fa-star"></i>
                                    }
                                </div>
                                <h6 class="mt-3">@reviewItem.Username - <span>@reviewItem.ReviewTime</span></h6>
                                <p>@reviewItem.ComicComment</p>
                            </div>
                        </div>
                    }
                </div>
                <div class="anime__details__form">
                    <form method="post" class="form-floating">
                        <div class="section-title form">
                            <h5>Bình luận của bạn</h5>
                        </div>
                        <textarea name="reviewComic" placeholder="Bình luận của bạn"></textarea>
                        <button type="submit" class="review__submit-button"><i class="fa fa-location-arrow"></i> Bình luận</button>
                    </form>
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="anime__details__sidebar">
                    <div class="section-title mb-4">
                        <h5>Bạn có thể thích...</h5>
                    </div>
                    @{
                        byte counter = 4;

                        foreach (var comic in Model.HotComicModels)
                        {
                            <div class="position-relative">
                                <div class="blur"></div>
                                <div class="product__sidebar__view__item set-bg" data-setbg="/image/comic/comic_avatar/@comic.ComicAvatar">
                                    <div class="ep">@comic.ComicLatestChapter</div>
                                    <div class="view"><i class="fa fa-eye"></i> @comic.NumberOfReaderHasRead</div>
                                    <h5>
                                        <a asp-page="MangaDetail" asp-route-ComicIdentifier="@comic.ComicIdentifier">@comic.ComicName</a>
                                    </h5>
                                </div>
                            </div>

                            if (counter == 1)
                            {
                                break;
                            }

                            counter--;
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Anime Section End -->
<!-- Footer Section Begin -->
<footer class="footer">
    <div class="page-up">
        <a href="#" id="scrollToTopButton"><span class="arrow_carrot-up"></span></a>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="footer__logo">
                    <a asp-page="Index"><img src="image/Logo.png" alt=""></a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="footer__nav">
                    <ul>
                        <li><a href="#">Liên Hệ</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- Footer Section End -->
<!-- Search model Begin -->
<div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch"><i class="icon_close"></i></div>
        <form class="search-model-form">
            <input type="text" id="search-input" placeholder="Search here.....">
        </form>
    </div>
</div>
<!-- Search model end -->
