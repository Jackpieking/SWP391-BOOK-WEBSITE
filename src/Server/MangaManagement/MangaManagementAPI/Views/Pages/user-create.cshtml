@page "/admin/user-create"
@model DTO.Incoming.UserDto
@{
	ViewData["Title"] = "Admin | Users Create";
}

@section ValidateScript {
    @await Html.PartialAsync("Pages/Shared/_ValidationScriptsPartial")
}

<div class="container-fluid">
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between">
            <h6 class="m-0 font-weight-bold text-primary h1">User Input</h6>
            <a asp-page="/Pages/users"
               class="mx-2 my-2 text-decoration-none btn btn-outline-danger d-block" style="font-size:20px">Return
            </a>
        </div>
        <div class="card-body">
            <form
                enctype="multipart/form-data"
                id="createUserForm"
                method="dialog">
                <div class="form-group">
                    <label for="UserAvatar">Avatar</label>
                    <input type="file" class="form-control-file" id="UserAvatar" name="UserAvatar" accept="image/*">
                </div>

                <div asp-validation-summary="ModelOnly"></div>

                <div class="form-group">
                    <label asp-for="Username">Username</label>
                    <input asp-for="Username" class="form-control" required>
                    <span class="text-danger" asp-validation-for="Username"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Password">Password</label>
                    <input type="password" class="form-control" asp-for="Password" required>
                    <span class="text-danger" asp-validation-for="Password"></span>
                    <br />
                    <button type="button"
                            class="btn btn-outline-warning ml-auto mt-2"
                            id="showPasswordBx">
                        Show Password
                    </button>
                </div>

                <div class="form-group">
                    <label asp-for="UserFullName">Full Name</label>
                    <input class="form-control" asp-for="UserFullName">
                    <span class="text-danger" asp-validation-for="UserFullName"></span>
                </div>

                <div class="form-group">
                    <label asp-for="UserGender">Gender</label>
                    <select class="form-control" asp-for="UserGender">
                        <option value="0">Male</option>
                        <option value="1">Female</option>
                        <option value="2">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="UserBirthday">Birthday</label>
                    <input type="date" class="form-control" asp-for="UserBirthday">
                </div>

                <div>
                    <label asp-for="UserPhoneNumber">Phone Number</label>
                    <input class="form-control" asp-for="UserPhoneNumber">
                    <span class="text-danger" asp-validation-for="UserPhoneNumber"></span>
                </div>

                <div>
                    <label asp-for="UserEmail">Email</label>
                    <input type="email" class="form-control" asp-for="UserEmail" required>
                    <span class="text-danger" asp-validation-for="UserEmail"></span>
                </div>

                <div>
                    <label asp-for="UserAccountBalance">Account Balance</label>
                    <input class="form-control" min="0" asp-for="UserAccountBalance" required>
                    <span class="text-danger" asp-validation-for="UserAccountBalance"></span>
                </div>

                <button
                    type="button"
                    class="btn btn-outline-danger mt-3 submitBtn w-25">
                    Create
                </button>

                <button type="submit"
                        class="d-none testValidateBtn">
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Confirm User Creation Modal -->
<div class="modal fade" id="confirmUserCreationModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-uppercase text-danger">Confirmation</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-primary">Confirm User Creation?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary closeBtn" data-dismiss="modal">No</button>
                <button type="button" class="btn btn-outline-danger confirmBtn">Yes</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Successfully Modal -->
<div class="modal fade" id="createSucceessfullyModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-success text-uppercase">Message</h5>
                <button type="button" class="close refreshPageBtn" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-primary">Created User Successfully !!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary refreshPageBtn" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- User is existed Modal -->
<div class="modal fade" id="userExistedModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger text-uppercase">Error</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-primary">User with this username is existed !!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<button type="button"
        class="btn btn-outline-danger mt-3 submitBtn popupCreatedSuccessullyBtn w-25 d-none"
        data-toggle="modal"
        data-target="#createSucceessfullyModal">
</button>

<button type="button"
        class="btn btn-outline-danger mt-3 submitBtn popupUserExistedBtn w-25 d-none"
        data-toggle="modal"
        data-target="#userExistedModal">
</button>

<script defer>
    document
        .querySelector("#showPasswordBx")
        .addEventListener("click", function (e) {
            var passwordInput = document.getElementById("Password");
            if (passwordInput.type === "password") {
                passwordInput.type = "text";
            } else {
                passwordInput.type = "password";
            }
        });

    $(".submitBtn").click(function () {
        $(".testValidateBtn").click();

        let classCheck = document.getElementsByClassName('field-validation-error').length > 0;

        if (!classCheck) {
            $("#confirmUserCreationModal").modal({ show: true });
        }
    });

    $(".confirmBtn").click(function () {
        let formData = new FormData();

        formData.append("Username", $('[Name=Username]').val());
        formData.append("Password", $('[Name=Password]').val());
        formData.append("UserFullName", $('[Name=UserFullName]').val());
        formData.append("UserGender", $('[Name=UserGender]').val());
        formData.append("UserBirthday", $('[Name=UserBirthday]').val());
        formData.append("UserPhoneNumber", $('[Name=UserPhoneNumber]').val());
        formData.append("UserEmail", $('[Name=UserEmail]').val());
        formData.append("UserAccountBalance", $('[Name=UserAccountBalance]').val());

        $.ajax({
            type: 'POST',
            url: '@Url.Action("CreatedAUser", "User")',
            contentType: false,
            processData: false,
            data: formData,
            statusCode: {
                200: function (response) {
                    document
                        .querySelector(".closeBtn")
                        .click();
                    document
                        .querySelector(".popupCreatedSuccessullyBtn")
                        .click();
                },
                422: function (jqXHR, textStatus) {
                    document
                        .querySelector(".closeBtn")
                        .click();
                    document

                    document
                        .querySelector(".popupUserExistedBtn")
                        .click();
                },
                500: function (jqXHR, textStatus) {
                    alert(textStatus + jqXHR.status);
                }
            }
        });
    });

    $(".refreshPageBtn").click(function () {
        location.reload();
    })
</script>